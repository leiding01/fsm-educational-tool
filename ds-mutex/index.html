<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FSM Educational Tool — DFA (v0.2)</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 20px; }
    header { display: flex; align-items: baseline; gap: 12px; }
    h1 { font-size: 20px; margin: 0; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    fieldset { border: 1px solid #ccc; border-radius: 8px; padding: 12px; }
    legend { padding: 0 6px; color: #444; }
    label { display: inline-block; margin: 4px 0; }
    input[type=text] { padding: 6px; }
    button { padding: 6px 10px; margin: 2px; }
    ul { list-style: none; padding-left: 0; }
    li { padding: 4px 6px; border-radius: 6px; display: flex; align-items: center; justify-content: space-between; }
    li.current { background: #e6f2ff; }
    .row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
    .note { color: #666; font-size: 12px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
    .ok { color: #0a7d00; }
    .bad { color: #a10000; }
    .pill { padding: 2px 6px; border-radius: 10px; background: #eee; }
    .accent { color: #0a7d00; font-weight: 600; }
    .toolbar { display: flex; align-items: center; gap: 8px; }
    #trace { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; white-space: nowrap; overflow-x: auto; }
    #previewWrap { display: grid; grid-template-columns: 1fr; gap: 8px; }
    #previewCanvas { border: 1px dashed #bbb; border-radius: 8px; }
  </style>
</head>
<body>
  <header>
    <h1>FSM Educational Tool — DFA (v0.2)</h1>
    <span class="pill">trace · delete state · undo · PNG export</span>
  </header>

  <div class="toolbar">
    <button id="undoBtn" title="Undo last action">Undo</button>
    <button id="clearAllBtn">Clear all</button>
  </div>
  <p class="note">Minimal but practical: add states/transitions, set start/accept, run & step a DFA; trace panel; delete state; undo; preview canvas + Export PNG. JSON import/export supported.</p>

  <div class="grid">
    <fieldset>
      <legend>States</legend>
      <div class="row">
        <label>New state:</label>
        <input id="stateName" type="text" placeholder="q0" />
        <button id="addStateBtn">Add</button>
      </div>
      <div class="row">
        <label>Start state:</label>
        <select id="startSelect"></select>
      </div>
      <div class="row">
        <label>Accept states:</label>
        <select id="acceptSelect" multiple size="4" style="min-width: 150px;"></select>
      </div>
      <ul id="stateList"></ul>
    </fieldset>

    <fieldset>
      <legend>Transitions (DFA)</legend>
      <div class="row">
        <label>From:</label>
        <select id="fromState"></select>
        <label>Symbol:</label>
        <input id="symbol" type="text" maxlength="1" placeholder="a"/>
        <label>To:</label>
        <select id="toState"></select>
        <button id="addTransBtn">Add transition</button>
      </div>
      <p class="note">DFA rule: at most one transition per (state, symbol). Duplicates are prevented.</p>
      <table>
        <thead><tr><th>From</th><th>Symbol</th><th>To</th><th></th></tr></thead>
        <tbody id="transTable"></tbody>
      </table>
    </fieldset>
  </div>

  <fieldset>
    <legend>Run / Step</legend>
    <div class="row">
      <label>Input string:</label>
      <input id="inputStr" type="text" placeholder="abba"/>
      <button id="runBtn">Run</button>
      <button id="stepBtn">Step</button>
      <button id="resetBtn">Reset</button>
      <span>Current state: <strong id="currentStateLabel">—</strong></span>
    </div>
    <div id="runResult"></div>
    <div><strong>Trace:</strong> <span id="trace">—</span></div>
  </fieldset>

  <fieldset>
    <legend>Import / Export</legend>
    <div class="row">
      <button id="exportBtn">Export JSON</button>
      <input id="importFile" type="file" accept="application/json"/>
      <button id="loadExample1">Load Example: Even number of 0s</button>
      <button id="loadExample2">Load Example: Ends with 'ab'</button>
    </div>
  </fieldset>

  <fieldset>
    <legend>Preview & Export PNG</legend>
    <div id="previewWrap">
      <div class="row">
        <button id="redrawBtn">Redraw preview</button>
        <button id="exportPngBtn">Export PNG</button>
      </div>
      <canvas id="previewCanvas" width="900" height="520"></canvas>
      <p class="note">The preview uses a simple circular layout; it is sufficient for a small to medium number of states. Self-loops are rendered above the state.</p>
    </div>
  </fieldset>

  <script type="module" src="main.js"></script>
</body>
</html>
